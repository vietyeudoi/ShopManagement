@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model List<Sieu_Thi_Mini.Models.OrderDetail>

@{
    Layout = "_LayoutCustomer";
    ViewData["Title"] = "Chi tiết đơn hàng";
    var order = ViewBag.Order as Sieu_Thi_Mini.Models.Order;
}

<style>
    .detail-container { background-color: #f8f9fa; padding: 30px 0; min-height: 85vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .detail-card { background: #fff; border-radius: 12px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); padding: 25px; margin-bottom: 20px; }
    .info-label { color: #777; font-size: 0.85rem; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.5px; }
    .info-value { font-weight: 600; color: #222; font-size: 0.95rem; }
    .table thead th { background-color: #f8f9fa; border: none; color: #555; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; padding: 15px; }
    .product-img { width: 65px; height: 65px; object-fit: cover; border-radius: 8px; border: 1px solid #f0f0f0; }
    .text-red { color: #e31837; font-weight: 700; }
    .btn-back { display: inline-flex; align-items: center; gap: 8px; color: #555; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: 0.2s; margin-bottom: 15px; }
    .btn-back:hover { color: #e31837; }
    .status-badge { padding: 6px 15px; border-radius: 20px; font-weight: 700; font-size: 0.8rem; }
</style>

<div class="detail-container">
    <div class="container">
        <a href="@Url.Action("History", "Order")" class="btn-back">
            <i class="bi bi-arrow-left"></i> Quay lại lịch sử đơn hàng
        </a>

        <div class="d-flex justify-content-between align-items-end mb-4">
            <div>
                <h2 class="fw-bold mb-0">Đơn hàng #@order?.OrderId</h2>
                <p class="text-muted mb-0 small">Ngày đặt: @order?.OrderDate?.ToString("dd/MM/yyyy HH:mm")</p>
            </div>
            <div>
                <span class="badge order.Status.ToBadge()">">order.status.ToVietNam()</span>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4">
                <div class="detail-card">
                    <h5 class="fw-bold mb-3 border-bottom pb-2">Thông tin nhận hàng</h5>
                    <div class="mb-3">
                        <div class="info-label">Người nhận</div>
                        <div class="info-value">@order?.Customer?.FullName</div>
                    </div>
                    <div class="mb-3">
                        <div class="info-label">Số điện thoại</div>
                        <div class="info-value">@order?.Customer?.Phone</div>
                    </div>
                    <div class="mb-3">
                        <div class="info-label">Địa chỉ</div>
                        <div class="info-value">@order?.Customer?.Address</div>
                    </div>
                    @* <div class="mb-0">
                        <div class="info-label">Ghi chú</div>
                        <div class="info-value text-muted italic" style="font-weight: 400;">
                            @(order?.Status?.Contains("Ghi chú") == true ? order.Status.Replace("Ghi chú: ", "") : "Không có ghi chú")
                        </div>
                    </div> *@

                </div>
                
                <div class="d-grid">
                    <a href="@Url.Action("History", "Order")" class="btn btn-outline-secondary py-2 fw-bold">
                        Quay lại danh sách
                    </a>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="detail-card">
                    <h5 class="fw-bold mb-3 border-bottom pb-2">Sản phẩm trong đơn</h5>
                    <div class="table-responsive">
                        <table class="table align-middle border-0">
                            <thead>
                                <tr>
                                    <th style="width: 50%;">Sản phẩm</th>
                                    <th class="text-center">SL</th>
                                    <th class="text-end">Đơn giá</th>
                                    <th class="text-end">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center gap-3">
                                                <img src="@item.Product?.ImageUrl" class="product-img">
                                                <div>
                                                    <div class="fw-bold" style="font-size: 0.9rem;">@item.Product?.ProductName</div>
                                                    <div class="text-muted small">Mã SP: @item.ProductId</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="text-center fw-bold">@item.Quantity</td>
                                        <td class="text-end text-muted">@item.UnitPrice.ToString("N0")đ</td>
                                        <td class="text-end fw-bold">@((item.UnitPrice * item.Quantity).ToString("N0"))đ</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="border-top mt-3 pt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Tạm tính</span>
                            <span>@order?.TotalAmount.ToString("N0")đ</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Phí vận chuyển</span>
                            <span class="text-success fw-bold">Miễn phí</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                            <h5 class="fw-bold mb-0">TỔNG CỘNG</h5>
                            <h4 class="text-red mb-0">@order?.TotalAmount.ToString("N0")đ</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
